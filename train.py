import pandas as pd
import numpy as np
import lightgbm as lgb
from utility import convert_time

def train_clf(train, test, col, clf):
    X = train[col]
    y = train['is_trade']
    X_tes = test[col]
    y_tes = test['is_trade']
    print(X.shape)
    clf.fit(X, y, eval_set=[(X_tes, y_tes)], early_stopping_rounds=200)
    iteration = clf.best_iteration_
    pred = clf.predict_proba(test[col])[:, 1]
    return iteration

def prediction(train, test, col, clf):
    X = train[col]
    y = train['is_trade']
    clf.fit(X, y, eval_set=[(X, y)])
    pred = clf.predict_proba(test[col])[:, 1]
    test['predicted_score'] = pred
    sub1 = test[['instance_id', 'predicted_score']]
    sub=pd.read_csv('data/test/round1_ijcai_18_test_b_20180418.txt',sep=' ')
    sub=pd.merge(sub,sub1,on=['instance_id'],how='left')
    sub=sub.fillna(0)
    print(sub)
    sub[['instance_id', 'predicted_score']].to_csv('data/output/robert_0420.txt',sep=" ",index=False)


if __name__ == "__main__":
    data = pd.read_csv('data/train/trainb.csv')
    item_category_list_unique = list(np.unique(data.item_category_list))
    data.item_category_list.replace(item_category_list_unique, list(np.arange(len(item_category_list_unique))), inplace=True)
    mean_age_gender = pd.read_csv('user_gender_id_user_age_level_mean.csv')
    data = data.merge(mean_age_gender, on = ['user_gender_id','user_age_level'], how = 'left')
    mean_age_gender = pd.read_csv('user_age_level_hour_mean.csv')
    data = data.merge(mean_age_gender, on = ['hour','user_age_level'], how = 'left')
    data.user_gender_id = data.user_gender_id.astype(float)
    data.user_age_level = data.user_age_level.astype(float)
    data.hour = data.hour.astype(float)
    train= data[(data['day'] < 24)]
    test= data[(data['day'] == 24)]
    col = ['item_category_list', 
                  'item_price_level', 
                  'item_sales_level', 
                  'item_collected_level', 'item_pv_level', 
                  'user_gender_id', 'user_age_level', 'user_occupation_id', 
                  'user_star_level', 
                  'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 
                  'shop_score_service', 'shop_score_delivery', 'hour', 'day', 
                  'user_id_query_day_hour', 
                  'shop_id', 
                  'item_id_query_day',  'user_id_query_day_item_brand_id', 
                  'user_id_query_day_hour_item_brand_id', 
                  'user_id_query_day', 'item_brand_id','user_id_query_day_item_id', 
                  'check_item_brand_id_ratio', 
                  'check_shop_id_ratio',
                  'check_item_category_list_ratio',
                  'check_ratio_day_all', 
                  'check_time_day',
                  'item_city_id_shop_cnt',
                  'item_city_id_shop_rev_prob', 
                  'item_id_shop_rev_cnt',
                  'item_property_list0',
                 ] # 008104
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'item_pv_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'shop_score_delivery', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'item_id_query_day', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'hour_map'] #Y 0.07887 008103
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'item_pv_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'shop_score_delivery', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'item_id_query_day', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'item_brand_id', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob'] # robert 007894 008100
    col = ['item_category_list', 
                  'item_price_level', 
                  'item_sales_level', 
                  'item_collected_level', 
                  #'item_pv_level', 
                  'user_gender_id', 
                  'user_age_level', 
                  'user_occupation_id', 
                  'user_star_level', 
                  'context_page_id', 
                  'shop_review_num_level', 
                  'shop_review_positive_rate', 
                  'shop_score_service', 
                  #'shop_score_delivery', 
                  'hour', 
                  'day', 
                  'user_id_query_day_hour', 
                  'shop_id', 
                  #'item_id_query_day', 
                  'user_id_query_day_item_brand_id', 
                  'user_id_query_day_hour_item_brand_id', 
                  'user_id_query_day',
                  #'item_brand_id',
                  'user_id_query_day_item_id', 
                  'check_item_brand_id_ratio',
                  'check_shop_id_ratio', 
                  'check_item_category_list_ratio', 
                  'check_ratio_day_all', 
                  'check_time_day', 
                  'item_city_id_shop_cnt', 
                  'item_city_id_shop_rev_prob', 
                  'item_id_shop_rev_cnt', 
                  'item_property_list0', 
                  'item_pv_level_price_prob', 
                  'item_collected_level_item_prob',
                  'item_sales_level_price_prob',
                  'item_city_id_cnt1d',
                 ] # 0.0787838429897982 008099
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_query_day_hour_map_item_pv_level'] # 0.078648 008097
    col = ['user_id_tradexd','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'item_pv_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'shop_score_delivery', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'item_id_query_day', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'item_brand_id', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob'] #007895 008099
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'check_item_brand_id_time_day', 'user_id_item_brand_id_tradexd'] #
    col = ['user_occupation_id_tradexd','user_occupation_id_item_price_level_tradexd','user_age_level_shop_review_num_level_tradexd','user_id_shop_id_tradexd','user_id_tradexd','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'item_pv_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'shop_score_delivery','hour', 'day', 'user_id_query_day_hour', 'shop_id', 'item_id_query_day', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'item_brand_id', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob'] # 008103
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_query_day_hour_map_item_pv_level','item_price_level_item_cnt','item_price_level_item_prob'] # 0078731 008096
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd'] #007855 008103
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd'] # 0078516 008075
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd', 'shop_star_level_user_prob', 'shop_id_user_prob'] #007827 008125
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_query_day_shop_id', 'shop_star_level_user_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd', 'shop_id_cnt1h'] # 007837 008115
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd', 'item_brand_id_user_prob'] #007836 
    col = ['check_min_difference_ahead', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd'] # 007834
    col = ['item_price_level_brand_cnt', 'item_brand_id_user_prob', 'check_min_difference_ahead', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd', 'check_item_brand_id_time_day'] # 0078136
    col = ['user_age_level_item_brand_id_trade_meanxd','item_city_id_brand_prob','item_price_level_brand_cnt','item_brand_id_user_prob','check_min_difference_ahead','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd'] # 007811 008081
    col = ['check_min_difference_ahead','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_query_day_hour_map_item_pv_level','item_price_level_item_cnt','item_price_level_item_prob'] # 084742 rober0409
#    col = ['user_id_item_category_list_tradexd', 'check_min_difference_ahead', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob']
    col = ['item_city_id_item_prob', 'item_brand_id_shop_rev_prob', 'item_price_level_brand_cnt', 'user_occupation_id_user_age_cnt', 'item_city_id_brand_prob', 'item_brand_id_shop_rev_cnt', 'item_brand_id_user_prob', 'user_id_item_category_list_tradexd', 'check_min_difference_ahead', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob'] #0.078082
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_query_day_hour_map_item_pv_level','item_price_level_item_cnt','item_price_level_item_prob','user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd']
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd','user_occupation_id', 'user_id_query_day_hour_map_item_pv_level', 'check_time_day', 'shop_review_num_level'] #Y 008075
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd'] #robert 008075
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_query_day_hour_map_item_pv_level','item_price_level_item_cnt','item_price_level_item_prob', 'user_id_item_category_list_tradexd'] # P
    col = ['user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'check_item_brand_id_ratio', 'user_id_query_min_map', 'item_brand_id_shop_cnt', 'user_id_query_day', 'user_gender_id_item_id_trade_meanxd']
    col = ['user_id_shop_cnt', 'user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'check_item_brand_id_ratio', 'user_id_query_min_map', 'item_brand_id_shop_cnt', 'user_id_query_day', 'user_gender_id_item_id_trade_meanxd', 'item_sales_level_city_cnt', 'user_id_item_category_list_trade_meanxd', 'predict_category_property0', 'check_item_category_list_ratio'] #MJ12 008079
    col = ['item_city_id_query_day', 'user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'item_brand_id_shop_cnt', 'user_id_query_min_map', 'item_brand_id_user_prob', 'user_id_item_category_list_trade_meanxd', 'user_gender_id_item_id_trade_meanxd', 'item_category_list2']
    col = ['user_id_shop_cnt', 'user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'check_item_brand_id_ratio', 'user_id_query_min_map', 'item_brand_id_shop_cnt', 'user_id_query_day', 'user_gender_id_item_id_trade_meanxd', 'item_sales_level_city_cnt', 'user_id_item_category_list_trade_meanxd', 'predict_category_property0', 'user_gender_id_item_city_id_tradexd', 'user_occupation_id_user_cnt', 'check_item_sales_level_ratio_hour_map', 'user_id_coll_prob'] #MJ14
    col = ['item_city_id_query_day', 'user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'item_brand_id_shop_cnt', 'user_id_query_min_map', 'item_brand_id_user_prob', 'user_id_item_category_list_trade_meanxd', 'user_gender_id_item_id_trade_meanxd', 'check_item_brand_id_ratio', 'check_context_page_id_time_day_hour_map', 'user_id_query_day', 'user_id_query_day_hour_item_sales_level', 'user_id_item_city_id_trade_meanxd'] #mj14_2
    col = ['user_id_shop_cnt', 'user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'check_item_brand_id_ratio', 'user_id_query_min_map', 'item_brand_id_shop_cnt', 'user_id_query_day', 'user_gender_id_item_id_trade_meanxd', 'item_sales_level_city_cnt', 'user_id_item_category_list_trade_meanxd', 'predict_category_property0', 'user_gender_id_item_city_id_tradexd', 'user_occupation_id_user_cnt', 'check_item_sales_level_ratio_hour_map', 'user_id_coll_prob','user_id_shop_cnt-check_item_brand_id_ratio']
    col = ['user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'item_brand_id_shop_cnt', 'user_id_query_min_map', 'item_brand_id_user_prob', 'user_id_item_category_list_trade_meanxd', 'user_gender_id_item_id_trade_meanxd', 'check_item_id_ratio'] #r15 day>18
    col = ['user_gender_id_user_age_level_mean_bayes', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd','user_occupation_id', 'user_id_query_day_hour_map_item_pv_level', 'check_time_day', 'shop_review_num_level'] # Y15
    col = ['user_age_level_hour_mean_bayes','user_gender_id_user_age_level_mean_bayes','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd','user_occupation_id', 'user_id_query_day_hour_map_item_pv_level', 'check_time_day', 'shop_review_num_level']
    col = ['check_ratio_day_all', 'check_min_difference_ahead', 'user_occupation_id_item_id_trade_meanxd', 'sale_collect', 'user_id_query_day_item_id', 'item_price_level_user_age_cnt', 'hour', 'item_id_user_prob', 'user_id_tradexd', 'check_item_brand_id_ratio', 'item_price_level_shop_cnt', 'item_city_id_query_day', 'item_id_user_occ_prob', 'user_star_level_user_gender_cnt', 'item_category_list2', 'user_id_shop_id_tradexd', 'context_page_id', 'item_brand_id_shop_prob', 'age0'] # MJ16
    col = ['check_ratio_day_all', 'check_min_difference_ahead', 'user_occupation_id_item_id_trade_meanxd', 'sale_collect', 'user_id_query_day_item_id', 'item_price_level_user_age_cnt', 'hour', 'item_id_user_prob', 'user_id_tradexd', 'check_item_brand_id_ratio', 'item_price_level_shop_cnt', 'item_city_id_query_day', 'gender_star', 'user_id_shop_id_trade_meanxd', 'user_gender_id_item_id_trade_meanxd', 'user_age_level_item_pv_level_tradexd']
    col = ['check_min_difference_ahead', 'user_gender_id_item_id_trade_meanxd', 'check_item_id_time_day', 'item_collected_level_salse_cnt', 'user_id_query_day_hour_map_item_category_list', 'user_age_level_item_price_level_trade_meanxd', 'user_age_level_item_pv_level_tradexd', 'user_star_level_user_age_cnt', 'shop_id_query_day', 'user_occupation_id_item_sales_level_trade_meanxd', 'item_brand_id_query_min_map', 'user_id_trade_meanxd', 'shop_review_num_level_user_prob', 'user_id_query_day_hour_item_id', 'item_pv_level_price_prob', 'check_item_category_list_ratio', 'user_id_item_city_id_trade_meanxd', 'check_item_sales_level_ratio_hour_map', 'check_context_page_id_ratio_hour_map', 'user_id_item_price_level_tradexd']
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id','check_ratio_day_all', 'check_min_difference_ahead', 'user_occupation_id_item_id_trade_meanxd', 'sale_collect', 'user_id_query_day_item_id', 'item_price_level_user_age_cnt', 'item_id_user_prob', 'user_id_tradexd', 'check_item_brand_id_ratio', 'item_price_level_shop_cnt', 'item_city_id_query_day', 'gender_star', 'user_id_shop_id_trade_meanxd', 'user_gender_id_item_id_trade_meanxd', 'user_age_level_item_pv_level_tradexd', 'user_age_level_item_category_list_trade_meanxd', 'user_id_brand_cnt', 'item_collected_level_user_prob', 'item_city_id_brand_prob', 'user_id_query_day_hour_map_item_category_list'] #r17
    col  = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id','check_min_difference_ahead', 'user_gender_id_item_id_trade_meanxd', 'check_item_id_time_day', 'item_collected_level_salse_cnt', 'user_id_query_day_hour_map_item_category_list', 'user_age_level_item_price_level_trade_meanxd', 'user_age_level_item_pv_level_tradexd', 'user_star_level_user_age_cnt', 'shop_id_query_day', 'user_occupation_id_item_sales_level_trade_meanxd', 'item_brand_id_query_min_map', 'user_id_trade_meanxd', 'shop_review_num_level_user_prob', 'user_id_query_day_hour_item_id', 'item_pv_level_price_prob', 'check_item_category_list_ratio', 'user_id_item_city_id_trade_meanxd', 'check_item_sales_level_ratio_hour_map', 'check_context_page_id_ratio_hour_map', 'user_id_item_price_level_tradexd', 'item_id_cntxd', 'user_gender_id_item_pv_level_trade_meanxd', 'user_id_query_day_item_price_level', 'item_sales_level_user_cnt'] #Y17
    col  = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id','check_ratio_day_all', 'check_min_difference_ahead', 'user_occupation_id_item_id_trade_meanxd', 'sale_collect', 'user_id_query_day_item_id', 'item_price_level_user_age_cnt', 'item_id_user_prob', 'user_id_tradexd', 'check_item_brand_id_ratio', 'item_price_level_shop_cnt', 'item_city_id_query_day', 'gender_star', 'user_id_shop_id_trade_meanxd', 'user_gender_id_item_id_trade_meanxd', 'user_age_level_item_pv_level_tradexd', 'user_age_level_item_category_list_trade_meanxd', 'user_id_brand_cnt', 'item_collected_level_user_prob', 'item_city_id_brand_prob', 'user_id_query_day_hour_map_item_category_list'] #mj17
    col = ['check_min_difference_ahead','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd','user_occupation_id', 'user_id_query_day_hour_map_item_pv_level', 'check_time_day', 'shop_review_num_level'] #MJ18
    col = ['check_min_difference_ahead','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd'] #r18
    col = ['check_min_difference_ahead','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd'] #Y18
    col = ['check_min_difference_ahead','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_occupation_id', 'user_star_level', 'context_page_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'check_time_day', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'user_id_query_day_hour_map_item_pv_level','item_price_level_item_cnt','item_price_level_item_prob'] #P18
    col = ['user_age_level_query_day', 'user_age_level_item_brand_id_trade_meanxd', 'item_city_id_brand_prob', 'item_price_level_brand_cnt', 'item_brand_id_user_prob', 'check_min_difference_ahead', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'shop_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd', 'item_city_id_user_gender_cnt', 'item_pv_level_item_cnt', 'user_id_query_day_hour_item_pv_level'] #p19
    col = ['user_age_level_query_day', 'user_age_level_item_brand_id_trade_meanxd', 'item_city_id_brand_prob', 'item_price_level_brand_cnt', 'item_brand_id_user_prob', 'check_min_difference_ahead', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'shop_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd', 'item_city_id_user_gender_cnt', 'item_pv_level_item_cnt', 'user_gender_id_item_id_trade_meanxd'] # Y19 0.008477
    col = ['user_id_shop_cnt', 'user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'check_item_brand_id_ratio', 'user_id_query_min_map', 'item_brand_id_shop_cnt', 'user_id_query_day', 'user_gender_id_item_id_trade_meanxd', 'item_sales_level_city_cnt', 'user_id_item_category_list_trade_meanxd', 'predict_category_property0', 'user_occupation_id_user_cnt', 'item_collected_level_shop_cnt', 'check_item_collected_level_ratio', 'item_city_id_user_prob', 'shop_review_num_level_user_occ_prob', 'check_item_category_list_min_difference'] #R19 0.008471
    col = ['user_age_level_query_day', 'user_age_level_item_brand_id_trade_meanxd', 'item_city_id_brand_prob', 'item_price_level_brand_cnt', 'item_brand_id_user_prob', 'check_min_difference_ahead', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'shop_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd', 'item_city_id_user_gender_cnt', 'item_pv_level_item_cnt', 'user_gender_id_item_id_trade_meanxd'] #P19 - 0.000716796796796 0.008492
    col = ['user_id_shop_cnt', 'user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'check_item_brand_id_ratio', 'user_id_query_min_map', 'item_brand_id_shop_cnt', 'user_id_query_day', 'user_gender_id_item_id_trade_meanxd', 'item_sales_level_city_cnt', 'user_id_item_category_list_trade_meanxd', 'predict_category_property0', 'user_occupation_id_user_cnt', 'item_collected_level_shop_cnt', 'check_item_collected_level_ratio', 'item_city_id_user_prob', 'shop_review_num_level_user_occ_prob', 'check_item_category_list_min_difference', 'user_id_query_day_item_brand_id', 'user_age_level_shop_review_num_level_trade_meanxd', 'user_id_query_day_hour_map_item_pv_level', 'user_gender_id_shop_review_num_level_trade_meanxd', 'user_id_query_day_hour_map_item_brand_id']
    col = ['check_context_page_id_time_day', 'user_age_level_query_day', 'user_age_level_item_brand_id_trade_meanxd', 'item_city_id_brand_prob', 'item_price_level_brand_cnt', 'item_brand_id_user_prob', 'check_min_difference_ahead', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'shop_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_id_shop_id_trade_meanxd', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd', 'item_city_id_user_gender_cnt', 'item_pv_level_item_cnt', 'user_gender_id_item_id_trade_meanxd', 'user_occupation_id_item_id_trade_meanxd', 'item_sales_level_item_prob']
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'check_item_brand_id_ratio', 'check_min_difference_ahead', 'item_city_id_shop_cnt', 'user_id_query_day_hour_item_id', 'item_pv_level_user_cnt', 'check_ratio_day_all']
    col = ['context_page_id', 'item_brand_id', 'item_category_list', 'item_city_id', 'item_collected_level', 'item_id', 'item_price_level', 'item_pv_level', 'item_sales_level', 'shop_id', 'shop_review_num_level', 'shop_review_positive_rate', 'shop_score_delivery', 'shop_score_description', 'shop_score_service', 'shop_star_level', 'user_age_level', 'user_gender_id', 'user_occupation_id', 'user_star_level', 'len_item_category', 'len_item_property', 'item_category_list1', 'item_category_list2', 'item_property_list0', 'item_property_list1', 'item_property_list2', 'item_property_list3', 'item_property_list4', 'item_property_list5', 'item_property_list6', 'item_property_list7', 'item_property_list8', 'item_property_list9', 'gender0', 'age0', 'occupation0', 'star0', 'hour', 'day', 'min', 'hour_map', 'hour_series', 'min_map', 'min_series', 'min_series_full', 'user_id_query_day', 'user_id_query_day_hour', 'user_id_query_day_hour_map', 'user_id_query_min_map', 'item_id_query_day', 'item_id_query_day_hour', 'item_id_query_day_hour_map', 'item_id_query_min_map', 'shop_id_query_day', 'shop_id_query_day_hour', 'shop_id_query_day_hour_map', 'shop_id_query_min_map', 'item_category_list_query_day', 'item_category_list_query_day_hour', 'item_category_list_query_day_hour_map', 'item_category_list_query_min_map', 'item_city_id_query_day', 'item_city_id_query_day_hour', 'item_city_id_query_day_hour_map', 'item_city_id_query_min_map', 'user_gender_id_query_day', 'user_gender_id_query_day_hour', 'user_gender_id_query_day_hour_map', 'user_gender_id_query_min_map', 'user_age_level_query_day', 'user_age_level_query_day_hour', 'user_age_level_query_day_hour_map', 'user_age_level_query_min_map', 'user_occupation_id_query_day', 'user_occupation_id_query_day_hour', 'user_occupation_id_query_day_hour_map', 'user_occupation_id_query_min_map', 'item_brand_id_query_day', 'item_brand_id_query_day_hour', 'item_brand_id_query_day_hour_map', 'item_brand_id_query_min_map', 'user_id_query_day_shop_id', 'user_id_query_day_hour_shop_id', 'user_id_query_day_hour_map_shop_id', 'check_shop_id_min_difference', 'check_shop_id_time_day', 'check_shop_id_ratio', 'check_shop_id_time_day_hour_map', 'check_shop_id_ratio_hour_map', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day_hour_map_item_brand_id', 'check_item_brand_id_min_difference', 'check_item_brand_id_time_day', 'check_item_brand_id_ratio', 'check_item_brand_id_time_day_hour_map', 'check_item_brand_id_ratio_hour_map', 'user_id_query_day_item_id', 'user_id_query_day_hour_item_id', 'user_id_query_day_hour_map_item_id', 'check_item_id_min_difference', 'check_item_id_time_day', 'check_item_id_ratio', 'check_item_id_time_day_hour_map', 'check_item_id_ratio_hour_map', 'user_id_query_day_item_category_list', 'user_id_query_day_hour_item_category_list', 'user_id_query_day_hour_map_item_category_list', 'check_item_category_list_min_difference', 'check_item_category_list_time_day', 'check_item_category_list_ratio', 'check_item_category_list_time_day_hour_map', 'check_item_category_list_ratio_hour_map', 'user_id_query_day_item_pv_level', 'user_id_query_day_hour_item_pv_level', 'user_id_query_day_hour_map_item_pv_level', 'check_item_pv_level_min_difference', 'check_item_pv_level_time_day', 'check_item_pv_level_ratio', 'check_item_pv_level_time_day_hour_map', 'check_item_pv_level_ratio_hour_map', 'user_id_query_day_item_sales_level', 'user_id_query_day_hour_item_sales_level', 'user_id_query_day_hour_map_item_sales_level', 'check_item_sales_level_min_difference', 'check_item_sales_level_time_day', 'check_item_sales_level_ratio', 'check_item_sales_level_time_day_hour_map', 'check_item_sales_level_ratio_hour_map', 'user_id_query_day_item_collected_level', 'user_id_query_day_hour_item_collected_level', 'user_id_query_day_hour_map_item_collected_level', 'check_item_collected_level_min_difference', 'check_item_collected_level_time_day', 'check_item_collected_level_ratio', 'check_item_collected_level_time_day_hour_map', 'check_item_collected_level_ratio_hour_map', 'user_id_query_day_item_price_level', 'user_id_query_day_hour_item_price_level', 'user_id_query_day_hour_map_item_price_level', 'check_item_price_level_min_difference', 'check_item_price_level_time_day', 'check_item_price_level_ratio', 'check_item_price_level_time_day_hour_map', 'check_item_price_level_ratio_hour_map', 'user_id_query_day_context_page_id', 'user_id_query_day_hour_context_page_id', 'user_id_query_day_hour_map_context_page_id', 'check_context_page_id_min_difference', 'check_context_page_id_time_day', 'check_context_page_id_ratio', 'check_context_page_id_time_day_hour_map', 'check_context_page_id_ratio_hour_map', 'check_min_difference', 'check_time_day', 'check_ratio_day_all', 'check_time_day_hour_map', 'check_ratio_day_hour_map_all', 'check_min_difference_ahead', 'len_predict_category_property', 'predict_category_property0', 'predict_category_property1', 'predict_category_property2', 'predict_category_property3', 'predict_category_property4', 'context_page0', 'shop_score_delivery0', 'normal_shop', 'user_id_cnt1d', 'item_id_cnt1d', 'shop_id_cnt1d', 'item_city_id_cnt1d', 'item_brand_id_cnt1d', 'item_property_list0_cnt1d', 'item_category_list_cnt1d', 'user_id_cntxd', 'item_id_cntxd', 'shop_id_cntxd', 'item_city_id_cntxd', 'item_brand_id_cntxd', 'item_property_list0_cntxd', 'item_category_list_cntxd', 'user_id_cnt1h', 'item_id_cnt1h', 'shop_id_cnt1h', 'item_city_id_cnt1h', 'item_brand_id_cnt1h', 'item_property_list0_cnt1h', 'item_category_list_cnt1h', 'user_id_cntxh', 'item_id_cntxh', 'shop_id_cntxh', 'item_city_id_cntxh', 'item_brand_id_cntxh', 'item_property_list0_cntxh', 'item_category_list_cntxh', 'user_id_tradexd', 'user_id_trade_meanxd', 'user_id_item_id_tradexd', 'user_id_item_id_trade_meanxd', 'user_id_item_category_list_tradexd', 'user_id_item_category_list_trade_meanxd', 'user_id_shop_id_tradexd', 'user_id_shop_id_trade_meanxd', 'user_id_item_brand_id_tradexd', 'user_id_item_brand_id_trade_meanxd', 'user_id_item_price_level_tradexd', 'user_id_item_price_level_trade_meanxd', 'user_id_item_sales_level_tradexd', 'user_id_item_sales_level_trade_meanxd', 'user_id_item_pv_level_tradexd', 'user_id_item_pv_level_trade_meanxd', 'user_id_shop_review_num_level_tradexd', 'user_id_shop_review_num_level_trade_meanxd', 'user_id_item_city_id_tradexd', 'user_id_item_city_id_trade_meanxd', 'user_age_level_tradexd', 'user_age_level_trade_meanxd', 'user_age_level_item_id_tradexd', 'user_age_level_item_id_trade_meanxd', 'user_age_level_item_category_list_tradexd', 'user_age_level_item_category_list_trade_meanxd', 'user_age_level_shop_id_tradexd', 'user_age_level_shop_id_trade_meanxd', 'user_age_level_item_brand_id_tradexd', 'user_age_level_item_brand_id_trade_meanxd', 'user_age_level_item_price_level_tradexd', 'user_age_level_item_price_level_trade_meanxd', 'user_age_level_item_sales_level_tradexd', 'user_age_level_item_sales_level_trade_meanxd', 'user_age_level_item_pv_level_tradexd', 'user_age_level_item_pv_level_trade_meanxd', 'user_age_level_shop_review_num_level_tradexd', 'user_age_level_shop_review_num_level_trade_meanxd', 'user_age_level_item_city_id_tradexd', 'user_age_level_item_city_id_trade_meanxd', 'user_gender_id_tradexd', 'user_gender_id_trade_meanxd', 'user_gender_id_item_id_tradexd', 'user_gender_id_item_id_trade_meanxd', 'user_gender_id_item_category_list_tradexd', 'user_gender_id_item_category_list_trade_meanxd', 'user_gender_id_shop_id_tradexd', 'user_gender_id_shop_id_trade_meanxd', 'user_gender_id_item_brand_id_tradexd', 'user_gender_id_item_brand_id_trade_meanxd', 'user_gender_id_item_price_level_tradexd', 'user_gender_id_item_price_level_trade_meanxd', 'user_gender_id_item_sales_level_tradexd', 'user_gender_id_item_sales_level_trade_meanxd', 'user_gender_id_item_pv_level_tradexd', 'user_gender_id_item_pv_level_trade_meanxd', 'user_gender_id_shop_review_num_level_tradexd', 'user_gender_id_shop_review_num_level_trade_meanxd', 'user_gender_id_item_city_id_tradexd', 'user_gender_id_item_city_id_trade_meanxd', 'user_occupation_id_tradexd', 'user_occupation_id_trade_meanxd', 'user_occupation_id_item_id_tradexd', 'user_occupation_id_item_id_trade_meanxd', 'user_occupation_id_item_category_list_tradexd', 'user_occupation_id_item_category_list_trade_meanxd', 'user_occupation_id_shop_id_tradexd', 'user_occupation_id_shop_id_trade_meanxd', 'user_occupation_id_item_brand_id_tradexd', 'user_occupation_id_item_brand_id_trade_meanxd', 'user_occupation_id_item_price_level_tradexd', 'user_occupation_id_item_price_level_trade_meanxd', 'user_occupation_id_item_sales_level_tradexd', 'user_occupation_id_item_sales_level_trade_meanxd', 'user_occupation_id_item_pv_level_tradexd', 'user_occupation_id_item_pv_level_trade_meanxd', 'user_occupation_id_shop_review_num_level_tradexd', 'user_occupation_id_shop_review_num_level_trade_meanxd', 'user_occupation_id_item_city_id_tradexd', 'user_occupation_id_item_city_id_trade_meanxd', 'sale_price', 'sale_collect', 'price_collect', 'gender_age', 'gender_occ', 'gender_star', 'user_id_item_cnt', 'user_id_item_prob', 'item_brand_id_item_cnt', 'item_brand_id_item_prob', 'item_city_id_item_cnt', 'item_city_id_item_prob', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'item_sales_level_item_cnt', 'item_sales_level_item_prob', 'item_collected_level_item_cnt', 'item_collected_level_item_prob', 'item_pv_level_item_cnt', 'item_pv_level_item_prob', 'user_id_brand_cnt', 'user_id_brand_prob', 'item_city_id_brand_cnt', 'item_city_id_brand_prob', 'item_price_level_brand_cnt', 'item_price_level_brand_prob', 'item_sales_level_brand_cnt', 'item_sales_level_brand_prob', 'item_collected_level_brand_cnt', 'item_collected_level_brand_prob', 'item_pv_level_brand_cnt', 'item_pv_level_brand_prob', 'item_price_level_city_cnt', 'item_price_level_city_prob', 'item_sales_level_city_cnt', 'item_sales_level_city_prob', 'item_collected_level_city_cnt', 'item_collected_level_city_prob', 'item_pv_level_city_cnt', 'item_pv_level_city_prob', 'user_id_price_cnt', 'user_id_price_prob', 'item_sales_level_price_cnt', 'item_sales_level_price_prob', 'item_collected_level_price_cnt', 'item_collected_level_price_prob', 'item_pv_level_price_cnt', 'item_pv_level_price_prob', 'user_id_salse_cnt', 'user_id_salse_prob', 'item_collected_level_salse_cnt', 'item_collected_level_salse_prob', 'item_pv_level_salse_cnt', 'item_pv_level_salse_prob', 'user_id_coll_cnt', 'user_id_coll_prob', 'item_pv_level_coll_cnt', 'item_pv_level_coll_prob', 'user_gender_id_user_cnt', 'user_gender_id_user_prob', 'user_age_level_user_cnt', 'user_age_level_user_prob', 'user_occupation_id_user_cnt', 'user_occupation_id_user_prob', 'user_star_level_user_cnt', 'user_star_level_user_prob', 'user_age_level_user_gender_cnt', 'user_age_level_user_gender_prob', 'user_occupation_id_user_gender_cnt', 'user_occupation_id_user_gender_prob', 'user_star_level_user_gender_cnt', 'user_star_level_user_gender_prob', 'user_occupation_id_user_age_cnt', 'user_occupation_id_user_age_prob', 'user_star_level_user_age_cnt', 'user_star_level_user_age_prob', 'user_star_level_user_occ_cnt', 'user_star_level_user_occ_prob', 'item_id_user_cnt', 'item_id_user_prob', 'item_brand_id_user_cnt', 'item_brand_id_user_prob', 'item_city_id_user_cnt', 'item_city_id_user_prob', 'item_price_level_user_cnt', 'item_price_level_user_prob', 'item_sales_level_user_cnt', 'item_sales_level_user_prob', 'item_collected_level_user_cnt', 'item_collected_level_user_prob', 'item_pv_level_user_cnt', 'item_pv_level_user_prob', 'item_id_user_gender_cnt', 'item_id_user_gender_prob', 'item_brand_id_user_gender_cnt', 'item_brand_id_user_gender_prob', 'item_city_id_user_gender_cnt', 'item_city_id_user_gender_prob', 'item_price_level_user_gender_cnt', 'item_price_level_user_gender_prob', 'item_sales_level_user_gender_cnt', 'item_sales_level_user_gender_prob', 'item_collected_level_user_gender_cnt', 'item_collected_level_user_gender_prob', 'item_pv_level_user_gender_cnt', 'item_pv_level_user_gender_prob', 'item_id_user_age_cnt', 'item_id_user_age_prob', 'item_brand_id_user_age_cnt', 'item_brand_id_user_age_prob', 'item_city_id_user_age_cnt', 'item_city_id_user_age_prob', 'item_price_level_user_age_cnt', 'item_price_level_user_age_prob', 'item_sales_level_user_age_cnt', 'item_sales_level_user_age_prob', 'item_collected_level_user_age_cnt', 'item_collected_level_user_age_prob', 'item_pv_level_user_age_cnt', 'item_pv_level_user_age_prob', 'item_id_user_occ_cnt', 'item_id_user_occ_prob', 'item_brand_id_user_occ_cnt', 'item_brand_id_user_occ_prob', 'item_city_id_user_occ_cnt', 'item_city_id_user_occ_prob', 'item_price_level_user_occ_cnt', 'item_price_level_user_occ_prob', 'item_sales_level_user_occ_cnt', 'item_sales_level_user_occ_prob', 'item_collected_level_user_occ_cnt', 'item_collected_level_user_occ_prob', 'item_pv_level_user_occ_cnt', 'item_pv_level_user_occ_prob', 'shop_id_user_cnt', 'shop_id_user_prob', 'shop_review_num_level_user_cnt', 'shop_review_num_level_user_prob', 'shop_star_level_user_cnt', 'shop_star_level_user_prob', 'shop_id_user_gender_cnt', 'shop_id_user_gender_prob', 'shop_review_num_level_user_gender_cnt', 'shop_review_num_level_user_gender_prob', 'shop_star_level_user_gender_cnt', 'shop_star_level_user_gender_prob', 'shop_id_user_age_cnt', 'shop_id_user_age_prob', 'shop_review_num_level_user_age_cnt', 'shop_review_num_level_user_age_prob', 'shop_star_level_user_age_cnt', 'shop_star_level_user_age_prob', 'shop_id_user_occ_cnt', 'shop_id_user_occ_prob', 'shop_review_num_level_user_occ_cnt', 'shop_review_num_level_user_occ_prob', 'shop_star_level_user_occ_cnt', 'shop_star_level_user_occ_prob', 'user_id_shop_cnt', 'user_id_shop_prob', 'item_id_shop_cnt', 'item_id_shop_prob', 'item_brand_id_shop_cnt', 'item_brand_id_shop_prob', 'item_city_id_shop_cnt', 'item_city_id_shop_prob', 'item_price_level_shop_cnt', 'item_price_level_shop_prob', 'item_sales_level_shop_cnt', 'item_sales_level_shop_prob', 'item_collected_level_shop_cnt', 'item_collected_level_shop_prob', 'item_pv_level_shop_cnt', 'item_pv_level_shop_prob', 'user_id_shop_rev_cnt', 'user_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_id_shop_rev_prob', 'item_brand_id_shop_rev_cnt', 'item_brand_id_shop_rev_prob', 'item_city_id_shop_rev_cnt', 'item_city_id_shop_rev_prob', 'item_price_level_shop_rev_cnt', 'item_price_level_shop_rev_prob', 'item_sales_level_shop_rev_cnt', 'item_sales_level_shop_rev_prob', 'item_collected_level_shop_rev_cnt', 'item_collected_level_shop_rev_prob', 'item_pv_level_shop_rev_cnt', 'item_pv_level_shop_rev_prob'] #P20
    col = ['check_min_difference_ahead','item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_gender_id', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'user_id_query_day_item_brand_id', 'user_id_query_day_hour_item_brand_id', 'user_id_query_day', 'user_id_query_day_item_id', 'check_item_brand_id_ratio', 'check_shop_id_ratio', 'check_item_category_list_ratio', 'check_ratio_day_all', 'item_city_id_shop_cnt', 'item_city_id_shop_rev_prob', 'item_id_shop_rev_cnt', 'item_property_list0', 'item_pv_level_price_prob', 'item_collected_level_item_prob', 'item_sales_level_price_prob', 'item_city_id_cnt1d', 'item_collected_level_user_age_cnt', 'item_price_level_item_cnt', 'item_price_level_item_prob', 'user_age_level_trade_meanxd', 'user_id_item_category_list_tradexd']  #y20
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'user_id_shop_cnt', 'user_id_query_day_item_id', 'check_ratio_day_all', 'item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_review_positive_rate', 'shop_score_service', 'hour', 'day', 'check_min_difference_ahead', 'check_item_brand_id_ratio', 'user_id_query_min_map', 'item_brand_id_shop_cnt', 'user_id_query_day', 'user_gender_id_item_id_trade_meanxd', 'item_sales_level_city_cnt', 'user_id_item_category_list_trade_meanxd', 'predict_category_property0', 'user_gender_id_item_city_id_tradexd', 'user_occupation_id_user_cnt', 'check_item_sales_level_ratio_hour_map', 'user_id_coll_prob']
    col = ['item_category_list', 'item_price_level', 'item_sales_level', 'item_collected_level', 'user_age_level', 'user_star_level', 'context_page_id', 'shop_score_service', 'hour', 'day', 'user_id_query_day_hour', 'shop_id', 'check_item_brand_id_ratio', 'check_min_difference_ahead', 'item_city_id_shop_cnt', 'user_id_query_day_hour_item_id', 'item_pv_level_user_cnt', 'check_ratio_day_all', 'user_id_query_day', 'user_id_query_day_item_price_level'] #r20
    clf = lgb.LGBMClassifier(random_state=1, num_leaves = 6,
                          n_estimators=200000,max_depth=3,learning_rate = 0.05,
                          subsample=1, n_jobs=30)
    iteration = train_clf(train, test, col, clf)
    clf.n_estimators = iteration
    train = data[~pd.isnull(data.is_trade)]
    test = data[data.used == 'b']
    prediction(train, test, col, clf)
